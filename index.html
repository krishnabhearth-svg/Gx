<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ðŸŒ¾ Krishi â€¢ Beej â€¢ Universal Ecological AI</title>
<style>
/* ===== GLOBAL STYLES ===== */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#f9fbfd;color:#2d3748;line-height:1.6;text-align:center}
.container{max-width:1000px;margin:0 auto;padding:20px}
.header{padding:25px 0;background:white;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);margin-bottom:30px}
h1{font-size:1.8em;color:#2d3748;margin-bottom:8px}
.subtitle{color:#718096;font-size:1.1em}
.search-box{display:flex;gap:12px;margin:25px 0;justify-content:center}
#queryInput{flex:1;max-width:500px;padding:16px 20px;border:2px solid #e2e8f0;border-radius:14px;font-size:1.1em;outline:none}
#queryInput:focus{border-color:#48bb78;box-shadow:0 0 0 3px rgba(72,187,120,0.1)}
.search-btn{background:#48bb78;color:white;border:none;border-radius:14px;padding:0 30px;font-weight:600;cursor:pointer;font-size:1.1em;transition:all 0.2s}
.search-btn:hover{background:#38a169;transform:translateY(-2px)}
.search-btn:disabled{background:#cbd5e0;cursor:not-allowed;transform:none}

/* ===== PROGRESS & STEPS ===== */
.progress-container{display:flex;justify-content:center;margin:25px 0;gap:15px}
.progress-item{display:flex;flex-direction:column;align-items:center}
.progress-dot{width:18px;height:18px;border-radius:50%;background:#e2e8f0;border:2px solid #e2e8f0;transition:all 0.3s}
.progress-dot.active{background:#48bb78;border-color:#48bb78;transform:scale(1.2)}
.progress-dot.completed{background:#38a169}
.progress-label{font-size:0.8em;color:#718096;margin-top:5px}

.step{display:none;animation:fadeIn 0.4s ease}
.step.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* ===== QUESTION BOX ===== */
.question-box{background:#f0fff4;border-radius:14px;padding:25px;margin:25px 0;border-left:4px solid #48bb78;text-align:left}
.question-title{font-size:1.4em;font-weight:600;margin-bottom:20px;color:#2d3748}
.options-grid{display:grid;grid-template-columns:1fr;gap:12px}
.option-btn{background:white;border:2px solid #e2e8f0;border-radius:12px;padding:16px;text-align:left;cursor:pointer;transition:all 0.2s;font-size:1.05em}
.option-btn:hover{border-color:#48bb78;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.08)}
.option-btn.selected{background:#48bb78;color:white;border-color:#48bb78}

/* ===== RESULTS SECTION ===== */
.results-container{background:white;border-radius:16px;padding:30px;box-shadow:0 4px 20px rgba(0,0,0,0.08);margin-top:30px}
.results-header h2{font-size:1.8em;margin-bottom:15px;color:#2d3748}
.original-query{color:#718096;margin-bottom:10px}
.enhanced-query{font-weight:600;font-size:1.3em;color:#2d3748;line-height:1.5;background:#f7fafc;padding:15px;border-radius:10px;margin:15px 0}
.semantic-info{background:#e6fffa;border-radius:10px;padding:15px;margin:20px 0;font-size:0.95em;color:#234e52}

.actions-section{margin:25px 0}
.section-title{font-size:1.3em;font-weight:600;margin-bottom:15px;color:#2d3748}
.action-items{display:flex;flex-wrap:wrap;gap:10px}
.action-item{background:#f0fff4;color:#276749;padding:10px 18px;border-radius:20px;font-size:0.95em;border:1px solid #c6f6d5}

/* ===== TABS ===== */
.search-tabs{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin:25px 0}
.tab{background:#edf2f7;border:none;border-radius:20px;padding:10px 16px;font-size:0.85em;cursor:pointer;transition:all 0.2s}
.tab.active{background:#48bb78;color:white}
.panel{display:none;text-align:left;padding:20px;background:#f8fafc;border-radius:12px;min-height:100px;margin-top:15px}
.panel.active{display:block}
.panel a{display:inline-block;color:#3182ce;text-decoration:none;font-weight:500;padding:12px 20px;border-radius:10px;background:white;border:2px solid #e2e8f0;transition:all 0.2s}
.panel a:hover{background:#ebf8ff;border-color:#3182ce;transform:translateY(-2px)}

/* ===== BUTTONS ===== */
.action-button{background:#48bb78;color:white;border:none;border-radius:12px;padding:14px 28px;font-size:1.1em;font-weight:600;cursor:pointer;transition:all 0.2s;margin:15px 10px;display:inline-block}
.action-button:hover{background:#38a169;transform:translateY(-2px)}
.action-button:disabled{background:#cbd5e0;cursor:not-allowed;transform:none}

/* ===== STATUS ===== */
.status-panel{background:#f7fafc;border-radius:12px;padding:20px;margin:20px 0;text-align:left}
.status-title{font-size:1.1em;font-weight:600;margin-bottom:15px;color:#2d3748}
.status-item{padding:8px 0;border-bottom:1px solid #edf2f7;display:flex;justify-content:space-between}
.status-indicator{width:10px;height:10px;border-radius:50%}
.status-ready{background:#48bb78}
.status-loading{background:#ed8936}
.status-error{background:#f56565}

/* ===== LOADING ===== */
.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.9);display:flex;justify-content:center;align-items:center;z-index:1000}
.loading-spinner{width:50px;height:50px;border:5px solid #e2e8f0;border-top:5px solid #48bb78;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* ===== RESPONSIVE ===== */
@media (max-width:768px){
  .container{padding:15px}
  .header{padding:20px 15px}
  h1{font-size:1.5em}
  .search-box{flex-direction:column}
  #queryInput{max-width:none}
  .options-grid{grid-template-columns:1fr}
  .action-item{font-size:0.85em;padding:8px 14px}
  .tab{padding:8px 12px;font-size:0.75em}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ðŸŒ¾ Krishi â€¢ Beej â€¢ Universal Ecological AI</h1>
    <p class="subtitle">Intelligent search for ecology, agriculture & human development with 3-step contextual refinement</p>
    
    <div class="status-panel">
      <div class="status-title">System Status</div>
      <div class="status-item">
        <span>Semantic DB</span>
        <span><span class="status-indicator status-loading" id="dbStatus"></span> Loading...</span>
      </div>
      <div class="status-item">
        <span>Vector DB</span>
        <span><span class="status-indicator status-loading" id="vectorStatus"></span> Checking...</span>
      </div>
      <div class="status-item">
        <span>Matches</span>
        <span id="matchCount">0</span>
      </div>
    </div>
  </div>

  <!-- STEP 0: INITIAL SEARCH -->
  <div class="step active" id="step0">
    <div class="search-box">
      <input type="text" id="queryInput" placeholder="e.g., pollution vehicle, organic farming, water conservation...">
      <button class="search-btn" onclick="startAnalysis()">Analyze & Continue â†’</button>
    </div>
    <div class="progress-container">
      <div class="progress-item">
        <div class="progress-dot active" id="dot0"></div>
        <div class="progress-label">Keyword</div>
      </div>
      <div class="progress-item">
        <div class="progress-dot" id="dot1"></div>
        <div class="progress-label">Context</div>
      </div>
      <div class="progress-item">
        <div class="progress-dot" id="dot2"></div>
        <div class="progress-label">Approach</div>
      </div>
      <div class="progress-item">
        <div class="progress-dot" id="dot3"></div>
        <div class="progress-label">Outcome</div>
      </div>
    </div>
  </div>

  <!-- STEP 1: CONTEXT QUESTION -->
  <div class="step" id="step1">
    <div class="question-box">
      <div class="question-title" id="contextQuestion">ðŸŽ¯ What's your main focus area?</div>
      <div class="options-grid" id="contextOptions"></div>
    </div>
    <button class="action-button" onclick="nextStep(1)" disabled>Next â†’</button>
  </div>

  <!-- STEP 2: APPROACH QUESTION -->
  <div class="step" id="step2">
    <div class="question-box">
      <div class="question-title" id="approachQuestion">ðŸ”„ How do you want to approach this?</div>
      <div class="options-grid" id="approachOptions"></div>
    </div>
    <button class="action-button" onclick="nextStep(2)" disabled>Next â†’</button>
  </div>

  <!-- STEP 3: OUTCOME QUESTION -->
  <div class="step" id="step3">
    <div class="question-box">
      <div class="question-title" id="outcomeQuestion">ðŸ’« What outcome are you seeking?</div>
      <div class="options-grid" id="outcomeOptions"></div>
    </div>
    <button class="action-button" onclick="generateResults()">Get Perfect Results â†’</button>
  </div>

  <!-- STEP 4: RESULTS -->
  <div class="step" id="step4">
    <div class="results-container">
      <div class="results-header">
        <h2>ðŸŽ‰ Your Enhanced Ecological Search Results</h2>
      </div>
      
      <div class="enhanced-query">
        Enhanced Query: "<span id="finalQuery"></span>"
      </div>
      
      <div class="semantic-info" id="semanticInfo"></div>
      
      <div class="actions-section">
        <div class="section-title">Recommended Actions</div>
        <div class="action-items" id="actionItems"></div>
      </div>
      
      <div class="section-title">Search Across Platforms</div>
      <div class="search-tabs">
        <button class="tab active" onclick="showTab('google')">Google</button>
        <button class="tab" onclick="showTab('scholar')">Scholar</button>
        <button class="tab" onclick="showTab('youtube')">YouTube</button>
        <button class="tab" onclick="showTab('kids')">Kids Wiki</button>
        <button class="tab" onclick="showTab('wiki')">Wikipedia</button>
        <button class="tab" onclick="showTab('amazon')">Amazon</button>
        <button class="tab" onclick="showTab('openlib')">OpenLibrary</button>
        <button class="tab" onclick="showTab('news')">News</button>
        <button class="tab" onclick="showTab('maps')">Maps</button>
        <button class="tab" onclick="showTab('weather')">Weather</button>
        <button class="tab" onclick="showTab('stocks')">Finance</button>
        <button class="tab" onclick="showTab('images')">Images</button>
        <button class="tab" onclick="showTab('translate')">Translate</button>
        <button class="tab" onclick="showTab('ted')">TED</button>
        <button class="tab" onclick="showTab('archive')">Archive</button>
      </div>
      
      <div class="panel active" id="google">
        <a id="googleLink" target="_blank">Google Search Results</a>
      </div>
      <div class="panel" id="scholar">
        <a id="scholarLink" target="_blank">Google Scholar Results</a>
      </div>
      <div class="panel" id="youtube">
        <a id="youtubeLink" target="_blank">YouTube Tutorials</a>
      </div>
      <div class="panel" id="kids">
        <a id="kidsLink" target="_blank">Kids Miraheze</a>
      </div>
      <div class="panel" id="wiki">
        <a id="wikiLink" target="_blank">Wikipedia</a>
      </div>
      <div class="panel" id="amazon">
        <a id="amazonLink" target="_blank">Amazon Books</a>
      </div>
      <div class="panel" id="openlib">
        <a id="openlibLink" target="_blank">OpenLibrary</a>
      </div>
      <div class="panel" id="news">
        <a id="newsLink" target="_blank">News Results</a>
      </div>
      <div class="panel" id="maps">
        <a id="mapsLink" target="_blank">Local Resources</a>
      </div>
      <div class="panel" id="weather">
        <a id="weatherLink" target="_blank">Weather</a>
      </div>
      <div class="panel" id="stocks">
        <a id="stocksLink" target="_blank">Finance</a>
      </div>
      <div class="panel" id="images">
        <a id="imagesLink" target="_blank">Images</a>
      </div>
      <div class="panel" id="translate">
        <a id="translateLink" target="_blank">Translate</a>
      </div>
      <div class="panel" id="ted">
        <a id="tedLink" target="_blank">TED Talks</a>
      </div>
      <div class="panel" id="archive">
        <a id="archiveLink" target="_blank">Archive.org</a>
      </div>
      
      <button class="action-button" style="background:#718096" onclick="resetSearch()">Start New Search</button>
    </div>
  </div>
</div>

<div class="loading-overlay" id="loadingOverlay" style="display:none">
  <div class="loading-spinner"></div>
</div>

<script>
// ========================================================================
// SIMPLIFIED SEMANTIC DATABASE - IMMEDIATE LOADING
// ========================================================================
const SEMANTIC_DB = {
  "organic farming": {
    vector: [0.88, 0.95, 0.74, 0.88, 0.85, 0.78],
    domain: "AGRICULTURE",
    semantic_cluster: ["sustainable farming", "permaculture", "agroecology", "regenerative agriculture"],
    questions: {
      context: {
        title: "ðŸŒ± What aspect of organic farming interests you most?",
        options: {
          "home_garden": "ðŸ  Starting home garden (small space, family use)",
          "commercial": "ðŸ¢ Commercial farming (business scale, markets)", 
          "health": "ðŸ’š Health benefits (nutrition, chemical-free)",
          "environment": "ðŸŒ Environmental impact (sustainability, biodiversity)",
          "community": "ðŸ‘¥ Community food security (shared resources, local)",
          "education": "ðŸŽ“ Learning & teaching (skills, workshops, courses)"
        }
      },
      approach: {
        title: "ðŸ› ï¸ How do you want to get involved with organic farming?",
        options: {
          "learn": "ðŸ“š Learn the basics (courses, tutorials, books)",
          "practice": "ðŸŒ¿ Start practicing (hands-on, immediate action)", 
          "community": "ðŸ¤ Join community garden (shared space, collaboration)",
          "business": "ðŸ’¼ Start small business (entrepreneurship, income)",
          "advocate": "ðŸ“¢ Promote organic farming (awareness, policy)",
          "research": "ðŸ”¬ Study advanced techniques (science, innovation)"
        }
      },
      outcome: {
        title: "ðŸŽ¯ What are you hoping to achieve through organic farming?",
        options: {
          "healthy_food": "ðŸŽ Grow healthy food (nutrition, safety, quality)",
          "save_money": "ðŸ’° Save money on groceries (self-sufficiency, cost)",
          "environment": "ðŸŒ± Help environment (sustainability, conservation)",
          "community": "ðŸ˜ï¸ Build community (connections, shared resources)", 
          "skills": "ðŸ› ï¸ Learn valuable skills (knowledge, capability)",
          "income": "ðŸ’µ Generate additional income (business, sales)"
        }
      }
    },
    actions: {
      immediate: ["Start small container garden", "Research local growing seasons", "Test soil pH basic kit"],
      short_term: ["Learn composting basics", "Join community garden tour", "Plant beginner-friendly herbs"],
      medium_term: ["Setup rainwater collection", "Create crop rotation plan", "Attend organic farming workshop"],
      long_term: ["Certify organic practices", "Start farmers market stall", "Teach organic gardening classes"]
    },
    search_strategies: {
      ecological: "organic farming soil health biodiversity regenerative agriculture",
      agricultural: "organic crop rotation pest management natural fertilizers",
      action: "how to start organic home garden beginners step by step"
    },
    trusted_sites: ["soilhealth.dac.gov.in", "krishi.gov.in/organic", "fauna.org/sustainable-ag"]
  },
  "pollution vehicle": {
    vector: [0.85, 0.72, 0.68, 0.79, 0.63, 0.81],
    domain: "ECOLOGY_TRANSPORT",
    semantic_cluster: ["emissions", "air quality", "EV", "public transport", "carbon footprint"],
    questions: {
      context: {
        title: "ðŸŒ«ï¸ What pollution aspect concerns you most?",
        options: {
          "air_quality": "ðŸŒ¬ï¸ Air quality impact (urban smog, health)",
          "health_effects": "ðŸ¥ Health effects (respiratory, children)",
          "climate_impact": "ðŸŒ¡ï¸ Climate change (global warming, emissions)",
          "noise_pollution": "ðŸ”‡ Noise pollution (urban stress)",
          "water_contamination": "ðŸ’§ Water contamination (runoff, oil)",
          "soil_degradation": "ðŸŒ± Soil degradation (heavy metals, toxins)"
        }
      },
      approach: {
        title: "ðŸ”„ How do you want to address vehicle pollution?",
        options: {
          "personal_change": "ðŸš¶ Personal change (transport choices)",
          "policy_advocacy": "ðŸ“¢ Policy advocacy (clean air laws)",
          "tech_innovation": "ðŸ’¡ Tech innovation (EV, clean tech)",
          "community_action": "ðŸ˜ï¸ Community action (carpool, clean zones)",
          "education": "ðŸŽ“ Education & awareness (workshops)",
          "business_solutions": "ðŸ’¼ Business solutions (green fleet)"
        }
      },
      outcome: {
        title: "ðŸŽ¯ What outcome matters most to you?",
        options: {
          "cleaner_air": "ðŸŒ¬ï¸ Cleaner air (immediate health)",
          "climate_action": "ðŸŒ Climate action (long-term)",
          "health_protection": "â¤ï¸ Health protection (family, community)",
          "economic_savings": "ðŸ’° Economic savings (fuel, health costs)",
          "policy_change": "ðŸ›ï¸ Policy change (systemic)",
          "tech_adoption": "âš¡ Tech adoption (EV, innovation)"
        }
      }
    },
    actions: {
      immediate: ["Calculate carbon footprint", "Use public transport this week", "Research EV options"],
      short_term: ["Join clean air advocacy group", "Switch to carpool", "Install air purifier"],
      medium_term: ["Purchase electric vehicle", "Move closer to work", "Support clean transit"],
      long_term: ["Advocate for EV infrastructure", "Start clean transport business", "Policy leadership"]
    },
    search_strategies: {
      ecological: "vehicle pollution air quality health impact emissions",
      agricultural: "farm machinery emissions sustainable transport biofuel alternatives",
      action: "reduce car pollution daily habits electric transport tutorial"
    },
    trusted_sites: ["cpcb.nic.in", "ev.gov.in", "gbif.org/pollution", "nasa.gov/earth/air-quality"]
  },
  "water conservation": {
    vector: [0.92, 0.85, 0.70, 0.78, 0.80, 0.82],
    domain: "ECOLOGY_AGRICULTURE",
    semantic_cluster: ["rainwater harvesting", "drip irrigation", "aquifer recharge", "greywater", "xeriscaping"],
    questions: {
      context: {
        title: "ðŸ’§ What water conservation area interests you?",
        options: {
          "home_use": "ðŸ  Home water use (indoor, appliances)",
          "gardening": "ðŸŒ¿ Gardening & landscaping (outdoor, plants)",
          "agriculture": "ðŸŒ¾ Agricultural use (farming, irrigation)",
          "community": "ðŸ˜ï¸ Community water (municipal, shared)",
          "industry": "ðŸ­ Industrial use (business, manufacturing)",
          "policy": "ðŸ›ï¸ Water policy (regulations, rights)"
        }
      },
      approach: {
        title: "ðŸ› ï¸ How do you want to implement water conservation?",
        options: {
          "immediate_actions": "âš¡ Immediate actions (fix leaks, habits)",
          "infrastructure": "ðŸ  Infrastructure (rain barrels, greywater)",
          "behavioral_change": "ðŸ§˜ Behavioral change (awareness, habits)",
          "technology": "ðŸ“± Technology (sensors, apps, automation)",
          "policy_work": "ðŸ›ï¸ Policy work (advocacy, regulations)",
          "education": "ðŸŽ“ Education (workshops, community)"
        }
      },
      outcome: {
        title: "ðŸŽ¯ What's your primary water conservation goal?",
        options: {
          "reduce_usage": "ðŸ“‰ Reduce water usage (immediate savings)",
          "sustainability": "ðŸŒ± Long-term sustainability (future security)",
          "environmental": "ðŸŒ Environmental protection (ecosystems)",
          "economic_savings": "ðŸ’° Economic savings (bills, costs)",
          "community_resilience": "ðŸ¤ Community resilience (shared security)",
          "climate_adaptation": "ðŸŒ¡ï¸ Climate adaptation (drought resilience)"
        }
      }
    },
    actions: {
      immediate: ["Install rain barrel", "Fix home leaks", "Use bucket instead of shower"],
      short_term: ["Plant native drought-resistant species", "Install low-flow fixtures", "Learn greywater system"],
      medium_term: ["Setup rainwater harvesting system", "Convert to drip irrigation", "Join watershed group"],
      long_term: ["Advocate for water policy", "Build community water system", "Start water business"]
    },
    search_strategies: {
      ecological: "water conservation rainwater harvesting ecosystem impact",
      agricultural: "drip irrigation small farms India water-wise crops",
      action: "DIY rooftop rainwater harvesting home setup tutorial"
    },
    trusted_sites: ["cgwb.gov.in", "rainwaterharvesting.org", "nabard.org/water", "krishi.gov.in/water"]
  },
  "mental calm": {
    vector: [0.65, 0.58, 0.92, 0.71, 0.82, 0.68],
    domain: "WELLNESS",
    semantic_cluster: ["mindfulness", "grounding", "bhajan", "breathwork", "nature therapy"],
    questions: {
      context: {
        title: "ðŸ˜Š What mental wellness aspect do you need?",
        options: {
          "stress_relief": "ðŸ˜« Stress relief (work, life pressure)",
          "anxiety_reduction": "ðŸ˜° Anxiety reduction (worry, panic)",
          "depression_support": "ðŸ˜” Depression support (mood, motivation)",
          "mindfulness": "ðŸ§  Mindfulness & peace (present moment)",
          "relationships": "ðŸ’ž Healthy relationships (communication)",
          "purpose": "ðŸŽ¯ Finding meaning & purpose (direction)"
        }
      },
      approach: {
        title: "ðŸŒ¿ How do you prefer to approach wellness?",
        options: {
          "self_care": "ðŸ’†â€â™€ï¸ Self-care practices (routine, habits)",
          "professional_help": "ðŸ‘¨â€âš•ï¸ Professional help (therapy, counseling)", 
          "community": "ðŸ‘¥ Community support (groups, sharing)",
          "nature": "ðŸŒ³ Nature-based healing (outdoors, ecotherapy)",
          "holistic": "ðŸŒˆ Holistic approaches (mind-body-spirit)",
          "spiritual": "ðŸ•Šï¸ Spiritual practices (meditation, connection)"
        }
      },
      outcome: {
        title: "ðŸ’« What wellness outcome do you seek?",
        options: {
          "peace": "â˜®ï¸ Inner peace & calm (tranquility, serenity)",
          "energy": "âš¡ More energy & motivation (vitality, drive)",
          "clarity": "ðŸ’¡ Mental clarity & focus (concentration, purpose)", 
          "connections": "ðŸ¤ Better relationships (intimacy, understanding)",
          "purpose": "ðŸŽ¯ Sense of purpose (meaning, direction)",
          "resilience": "ðŸ›¡ï¸ Emotional resilience (coping, adaptability)"
        }
      }
    },
    actions: {
      immediate: ["Practice 5-minute breathing", "Take nature break", "Write gratitude list"],
      short_term: ["Establish sleep routine", "Digital detox hours", "Join support community"],
      medium_term: ["Regular exercise routine", "Therapy sessions", "Mindfulness practice"],
      long_term: ["Lifestyle transformation", "Deep healing work", "Become wellness advocate"]
    },
    search_strategies: {
      ecological: "nature connection mental calm grounding biophilia",
      agricultural: "therapeutic gardening stress reduction mental wellness",
      action: "5-minute daily mindfulness technique for beginners"
    },
    trusted_sites: ["nih.gov/mindfulness", "who.int/mental-health", "krishi.gov.in/wellness", "community-bhajan.org"]
  },
  "renewable energy": {
    vector: [0.94, 0.67, 0.62, 0.71, 0.76, 0.83],
    domain: "ECOLOGY_TECH",
    semantic_cluster: ["solar", "wind", "biogas", "hydro", "geothermal", "sustainable"],
    questions: {
      context: {
        title: "âš¡ What renewable energy interests you?",
        options: {
          "solar": "â˜€ï¸ Solar power (panels, home systems)",
          "wind": "ðŸŒ¬ï¸ Wind energy (turbines, community)",
          "bioenergy": "ðŸŒ¿ Bioenergy (biomass, biogas, waste)",
          "hydro": "ðŸ’§ Hydropower (micro, community)",
          "geothermal": "ðŸŒ‹ Geothermal (heating, cooling)",
          "policy": "ðŸ›ï¸ Energy policy (regulations, incentives)"
        }
      },
      approach: {
        title: "ðŸ› ï¸ How do you want to engage with renewable energy?",
        options: {
          "home_installation": "ðŸ  Home installation (DIY, professional)",
          "community_projects": "ðŸ˜ï¸ Community projects (shared systems)",
          "business": "ðŸ’¼ Business opportunities (investment, startup)",
          "policy_advocacy": "ðŸ“¢ Policy advocacy (clean energy laws)",
          "education": "ðŸŽ“ Education & learning (courses, workshops)",
          "research": "ðŸ”¬ Research & innovation (tech development)"
        }
      },
      outcome: {
        title: "ðŸŽ¯ What's your renewable energy goal?",
        options: {
          "energy_independence": "ðŸ”‹ Energy independence (self-sufficiency)",
          "cost_savings": "ðŸ’° Cost savings (bills, ROI)",
          "environmental": "ðŸŒ± Environmental impact (emissions reduction)",
          "community_benefit": "ðŸ¤ Community benefit (shared access)",
          "career": "ðŸ’¼ Career development (jobs, skills)",
          "climate_action": "ðŸŒ Climate action (global impact)"
        }
      }
    },
    actions: {
      immediate: ["Research solar home systems", "Calculate energy usage", "Check local incentives"],
      short_term: ["Attend renewable energy workshop", "Join community energy co-op", "Audit home energy"],
      medium_term: ["Install solar panels", "Start biogas system", "Invest in community project"],
      long_term: ["Build renewable business", "Policy leadership", "Innovation development"]
    },
    search_strategies: {
      ecological: "renewable energy climate impact sustainability",
      agricultural: "biogas from farm waste solar irrigation pumps",
      action: "affordable solar setup for rural home DIY tutorial"
    },
    trusted_sites: ["mnre.gov.in", "niti.gov.in/renewable", "irena.org", "fauna.org/energy"]
  },
  "fallback": {
    vector: [0.60, 0.55, 0.65, 0.63, 0.58, 0.50],
    domain: "GENERAL",
    semantic_cluster: ["learning", "search", "exploration", "discovery"],
    questions: {
      context: {
        title: "ðŸ” What are you exploring?",
        options: {
          "environment": "ðŸŒ Environmental solutions",
          "health": "â¤ï¸ Health & wellness", 
          "learning": "ðŸ“š Learning & skills",
          "community": "ðŸ˜ï¸ Community development",
          "business": "ðŸ’¼ Business & economics",
          "technology": "ðŸ’» Technology & innovation"
        }
      },
      approach: {
        title: "ðŸ”„ How do you want to proceed?",
        options: {
          "learn": "ðŸ“š Learn & understand",
          "action": "âœ… Take practical action", 
          "community": "ðŸ¤ Join community efforts",
          "research": "ðŸ”¬ Study & research",
          "create": "ðŸŽ¨ Create & build",
          "advocate": "ðŸ“¢ Advocate & influence"
        }
      },
      outcome: {
        title: "ðŸ’« What outcome matters most?",
        options: {
          "personal": "ðŸ‘¤ Personal improvement", 
          "community": "ðŸ˜ï¸ Community benefit",
          "environment": "ðŸŒ Environmental impact",
          "knowledge": "ðŸ§  Knowledge & understanding",
          "economic": "ðŸ’° Economic benefit",
          "spiritual": "ðŸ•Šï¸ Spiritual growth"
        }
      }
    },
    actions: {
      immediate: ["Research options", "Join relevant community", "Start with small steps"],
      short_term: ["Learn fundamentals", "Connect with experts", "Experiment locally"],
      medium_term: ["Develop deeper skills", "Build projects", "Share knowledge"],
      long_term: ["Master the field", "Teach others", "Create systemic change"]
    },
    search_strategies: {
      ecological: "sustainable ecological regenerative organic",
      agricultural: "agricultural farming rural sustainable",
      action: "how to practical guide beginners"
    },
    trusted_sites: ["fauna.org", "krishi.gov.in", "sustainability.org", "ecology.org"]
  }
};

// ========================================================================
// SIMPLIFIED UNIVERSAL SEMANTIC PROCESSOR
// ========================================================================
class UniversalSemanticProcessor {
  constructor() {
    this.semanticDB = SEMANTIC_DB;
    this.userAnswers = {};
    this.currentMatch = null;
    this.searchHistory = [];
    this.initializeStatus();
  }

  initializeStatus() {
    // Database is immediately available
    document.getElementById('dbStatus').className = 'status-indicator status-ready';
    document.getElementById('dbStatus').nextSibling.textContent = ' Ready';
    
    document.getElementById('vectorStatus').className = 'status-indicator status-ready';
    document.getElementById('vectorStatus').nextSibling.textContent = ' Connected';
  }

  analyzeKeyword(keyword) {
    const match = this.findSemanticMatch(keyword);
    this.currentMatch = match;
    return {
      match: match,
      keyword: keyword
    };
  }

  findSemanticMatch(query) {
    query = query.toLowerCase().trim();
    
    // Direct match
    if (this.semanticDB[query]) {
      return { term: query, data: this.semanticDB[query], score: 1.0, type: 'exact' };
    }
    
    // Word overlap match
    for (const [term, data] of Object.entries(this.semanticDB)) {
      const termWords = term.split(' ');
      const queryWords = query.split(' ');
      
      let overlap = 0;
      for (const tWord of termWords) {
        for (const qWord of queryWords) {
          if (tWord.includes(qWord) || qWord.includes(tWord)) {
            overlap++;
            break;
          }
        }
      }
      
      if (overlap > 0) {
        const score = overlap / Math.max(termWords.length, queryWords.length);
        if (score > 0.3) { // Minimum threshold
          return { term, data, score, type: 'word_overlap' };
        }
      }
    }
    
    // Fallback
    return { term: 'fallback', data: this.semanticDB['fallback'], score: 0.3, type: 'fallback' };
  }

  generateQuestions(match) {
    return match.data.questions || this.semanticDB['fallback'].questions;
  }

  buildEnhancedQuery(original, match, answers) {
    let baseQuery = original;
    
    // Add context modifiers
    if (answers.context && match.data.search_strategies) {
      const strategyKey = this.getContextStrategyKey(answers.context);
      if (match.data.search_strategies[strategyKey]) {
        baseQuery = match.data.search_strategies[strategyKey];
      }
    }
    
    // Add ecological context
    if (match.data.domain && match.data.domain.includes('ECOLOGY')) {
      baseQuery += ' sustainable ecological organic regenerative';
    } else if (match.data.domain && match.data.domain.includes('AGRICULTURE')) {
      baseQuery += ' organic sustainable regenerative farming';
    } else {
      baseQuery += ' sustainable ecological practical solutions';
    }
    
    return baseQuery;
  }

  getContextStrategyKey(context) {
    // Map context answers to search strategy keys
    const mapping = {
      'home_garden': 'ecological',
      'commercial': 'agricultural',
      'health': 'ecological',
      'environment': 'ecological',
      'community': 'action',
      'education': 'action',
      'air_quality': 'ecological',
      'health_effects': 'agricultural',
      'climate_impact': 'ecological',
      'personal_change': 'action',
      'policy_advocacy': 'ecological',
      'self_care': 'action'
    };
    return mapping[context] || 'ecological';
  }

  generateActions(match, answers) {
    let actions = [];
    
    // Determine action category based on approach
    let actionCategory = 'immediate';
    if (answers.approach === 'practice' || answers.approach === 'action') {
      actionCategory = 'short_term';
    } else if (answers.approach === 'business' || answers.approach === 'research') {
      actionCategory = 'medium_term';
    }
    
    if (match.data.actions && match.data.actions[actionCategory]) {
      actions = [...match.data.actions[actionCategory]];
    } else if (match.data.actions) {
      // Get all actions and flatten
      actions = Object.values(match.data.actions).flat();
    }
    
    // Ensure we have actions
    if (actions.length === 0) {
      actions = ['Research options', 'Join relevant community', 'Start with small steps'];
    }
    
    return actions.slice(0, 5); // Return max 5 actions
  }

  updateMatchCount() {
    this.searchHistory.push(new Date());
    document.getElementById('matchCount').textContent = this.searchHistory.length;
  }
}

// ========================================================================
// MAIN APPLICATION
// ========================================================================
const processor = new UniversalSemanticProcessor();
let currentAnalysis = null;
let userAnswers = { context: null, approach: null, outcome: null };

function showLoading(show) {
  const overlay = document.getElementById('loadingOverlay');
  overlay.style.display = show ? 'flex' : 'none';
}

function startAnalysis() {
  const query = document.getElementById('queryInput').value.trim();
  if (!query) {
    alert('Please enter a search term');
    return;
  }
  
  try {
    showLoading(true);
    
    // Small delay to show loading (optional)
    setTimeout(() => {
      currentAnalysis = processor.analyzeKeyword(query);
      const questions = processor.generateQuestions(currentAnalysis.match);
      
      // Update UI to Step 1
      document.getElementById('contextQuestion').textContent = questions.context.title;
      const contextOptions = document.getElementById('contextOptions');
      contextOptions.innerHTML = '';
      Object.entries(questions.context.options).forEach(([value, text]) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = text;
        btn.onclick = () => selectAnswer('context', value, btn);
        contextOptions.appendChild(btn);
      });
      
      showStep(1);
      processor.updateMatchCount();
      showLoading(false);
    }, 500);
    
  } catch (error) {
    console.error("Start analysis failed:", error);
    showLoading(false);
    alert('Sorry, there was an error processing your query. Please try again.');
  }
}

function selectAnswer(type, value, button) {
  // Remove selected class from all buttons in this step
  const step = type === 'context' ? 1 : type === 'approach' ? 2 : 3;
  const buttons = document.querySelectorAll(`#step${step} .option-btn`);
  buttons.forEach(btn => btn.classList.remove('selected'));
  
  // Add selected class to clicked button
  button.classList.add('selected');
  
  // Store answer
  userAnswers[type] = value;
  
  // Enable next button
  const nextBtn = document.querySelector(`#step${step} .action-button`);
  nextBtn.disabled = false;
}

function nextStep(currentStep) {
  if (currentStep === 1) {
    // Move to Step 2 - Approach
    const questions = processor.generateQuestions(currentAnalysis.match);
    document.getElementById('approachQuestion').textContent = questions.approach.title;
    const approachOptions = document.getElementById('approachOptions');
    approachOptions.innerHTML = '';
    Object.entries(questions.approach.options).forEach(([value, text]) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn';
      btn.textContent = text;
      btn.onclick = () => selectAnswer('approach', value, btn);
      approachOptions.appendChild(btn);
    });
    showStep(2);
  } else if (currentStep === 2) {
    // Move to Step 3 - Outcome
    const questions = processor.generateQuestions(currentAnalysis.match);
    document.getElementById('outcomeQuestion').textContent = questions.outcome.title;
    const outcomeOptions = document.getElementById('outcomeOptions');
    outcomeOptions.innerHTML = '';
    Object.entries(questions.outcome.options).forEach(([value, text]) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn';
      btn.textContent = text;
      btn.onclick = () => selectAnswer('outcome', value, btn);
      outcomeOptions.appendChild(btn);
    });
    showStep(3);
  }
}

function generateResults() {
  try {
    const enhancedQuery = processor.buildEnhancedQuery(
      currentAnalysis.keyword, 
      currentAnalysis.match, 
      userAnswers
    );
    const actions = processor.generateActions(currentAnalysis.match, userAnswers);
    
    // Update results UI
    document.getElementById('finalQuery').textContent = enhancedQuery;
    
    // Build semantic info
    const match = currentAnalysis.match;
    document.getElementById('semanticInfo').innerHTML = `
      <strong>Semantic Analysis:</strong><br>
      â€¢ Matched: "${match.term}" (${match.type})<br>
      â€¢ Domain: ${match.data.domain || 'General'}<br>
      â€¢ Confidence: ${(match.score * 100).toFixed(0)}%<br>
      â€¢ Context: ${userAnswers.context || 'general'}
    `;
    
    // Update actions
    document.getElementById('actionItems').innerHTML = 
      actions.map(action => `<div class="action-item">${action}</div>`).join('');
    
    // Update all search tabs
    updateSearchTabs(enhancedQuery, currentAnalysis.keyword);
    
    showStep(4);
  } catch (error) {
    console.error("Generate results failed:", error);
    alert('Sorry, there was an error generating results. Please try again.');
  }
}

function updateSearchTabs(enhancedQuery, originalQuery) {
  const e = encodeURIComponent;
  
  // Enhanced searches
  document.getElementById('googleLink').href = `https://www.google.com/search?q=${e(enhancedQuery)}`;
  document.getElementById('googleLink').textContent = `Google: ${enhancedQuery}`;
  
  document.getElementById('scholarLink').href = `https://scholar.google.com/scholar?q=${e(enhancedQuery + ' research study')}`;
  document.getElementById('scholarLink').textContent = `Scholar: ${enhancedQuery} research`;
  
  document.getElementById('youtubeLink').href = `https://www.youtube.com/results?search_query=${e(enhancedQuery + ' tutorial beginners')}`;
  document.getElementById('youtubeLink').textContent = `YouTube: ${enhancedQuery} tutorials`;
  
  // Other tabs
  document.getElementById('amazonLink').href = `https://www.amazon.com/s?k=${e(enhancedQuery + ' books sustainable')}`;
  document.getElementById('amazonLink').textContent = `Amazon: Sustainable ${enhancedQuery} books`;
  
  document.getElementById('newsLink').href = `https://news.google.com/search?q=${e(enhancedQuery + ' latest news')}`;
  document.getElementById('newsLink').textContent = `News: ${enhancedQuery} news`;
  
  document.getElementById('weatherLink').href = `https://www.google.com/search?q=weather+${e(originalQuery)}`;
  document.getElementById('weatherLink').textContent = `Weather for "${originalQuery}"`;
  
  document.getElementById('stocksLink').href = `https://www.google.com/finance?q=${e(originalQuery + ' ESG sustainable')}`;
  document.getElementById('stocksLink').textContent = `Finance: ${originalQuery} ESG`;
  
  document.getElementById('imagesLink').href = `https://www.google.com/search?tbm=isch&q=${e(enhancedQuery)}`;
  document.getElementById('imagesLink').textContent = `Images: ${enhancedQuery}`;
  
  document.getElementById('mapsLink').href = `https://www.google.com/maps/search/${e(originalQuery + ' organic community')}`;
  document.getElementById('mapsLink').textContent = `Maps: Organic ${originalQuery} resources`;
  
  document.getElementById('translateLink').href = `https://translate.google.com/?sl=auto&tl=en&text=${e(originalQuery)}`;
  document.getElementById('translateLink').textContent = `Translate: ${originalQuery}`;
  
  document.getElementById('tedLink').href = `https://www.ted.com/search?q=${e(enhancedQuery + ' sustainability')}`;
  document.getElementById('tedLink').textContent = `TED Talks: ${enhancedQuery} sustainability`;
  
  document.getElementById('archiveLink').href = `https://archive.org/search.php?query=${e(enhancedQuery + ' sustainable agriculture ecology')}`;
  document.getElementById('archiveLink').textContent = `Archive.org: Sustainable ${enhancedQuery}`;
  
  // API-based searches
  fetchMiraheze(enhancedQuery, 'kidsLink');
  fetchWikipedia(enhancedQuery, 'wikiLink');
  fetchOpenLibrary(enhancedQuery, 'openlibLink');
}

// API Fetchers with improved error handling
async function fetchMiraheze(q, elementId) {
  const link = document.getElementById(elementId);
  link.innerHTML = 'Loading...';
  try {
    const res = await fetch(`https://kids.miraheze.org/w/api.php?action=query&list=search&format=json&origin=*&srlimit=3&srsearch=${encodeURIComponent(q)}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    const results = data?.query?.search || [];
    link.innerHTML = results.length > 0 ? 
      `Kids Wiki: ${q}` : 
      `No results for "${q}"`;
    link.href = `https://kids.miraheze.org/w/index.php?search=${encodeURIComponent(q)}`;
  } catch (e) {
    console.error('Miraheze fetch error:', e);
    link.innerHTML = 'Error loading Kids Wiki';
    link.href = `https://kids.miraheze.org/w/index.php?search=${encodeURIComponent(q)}`;
  }
}

async function fetchWikipedia(q, elementId) {
  const link = document.getElementById(elementId);
  link.innerHTML = 'Loading...';
  try {
    const res = await fetch(`https://en.wikipedia.org/w/api.php?action=query&list=search&format=json&origin=*&srlimit=3&srsearch=${encodeURIComponent(q)}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    const results = data?.query?.search || [];
    link.innerHTML = results.length > 0 ? 
      `Wikipedia: ${q}` : 
      `No results for "${q}"`;
    link.href = `https://en.wikipedia.org/w/index.php?search=${encodeURIComponent(q)}`;
  } catch (e) {
    console.error('Wikipedia fetch error:', e);
    link.innerHTML = 'Error loading Wikipedia';
    link.href = `https://en.wikipedia.org/w/index.php?search=${encodeURIComponent(q)}`;
  }
}

async function fetchOpenLibrary(q, elementId) {
  const link = document.getElementById(elementId);
  link.innerHTML = 'Loading...';
  try {
    const res = await fetch(`https://openlibrary.org/search.json?limit=3&q=${encodeURIComponent(q)}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    const results = data?.docs || [];
    link.innerHTML = results.length > 0 ? 
      `OpenLibrary: ${q}` : 
      `No books for "${q}"`;
    link.href = `https://openlibrary.org/search?q=${encodeURIComponent(q)}`;
  } catch (e) {
    console.error('OpenLibrary fetch error:', e);
    link.innerHTML = 'Error loading OpenLibrary';
    link.href = `https://openlibrary.org/search?q=${encodeURIComponent(q)}`;
  }
}

function showStep(stepNumber) {
  // Hide all steps
  document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
  // Show target step
  document.getElementById(`step${stepNumber}`).classList.add('active');
  
  // Update progress dots
  for (let i = 0; i <= 3; i++) {
    const dot = document.getElementById(`dot${i}`);
    if (dot) {
      dot.className = 'progress-dot';
      if (i < stepNumber) {
        dot.classList.add('completed');
      } else if (i === stepNumber) {
        dot.classList.add('active');
      }
    }
  }
}

function showTab(tabId) {
  // Hide all panels
  document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
  // Show target panel
  document.getElementById(tabId).classList.add('active');
  
  // Update tab buttons
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
}

function resetSearch() {
  // Reset UI
  document.getElementById('queryInput').value = '';
  userAnswers = { context: null, approach: null, outcome: null };
  currentAnalysis = null;
  
  // Reset step selections
  document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
  document.querySelectorAll('.action-button').forEach(btn => btn.disabled = true);
  
  // Go back to step 0
  showStep(0);
  
  // Reset progress dots
  document.querySelectorAll('.progress-dot').forEach((dot, index) => {
    dot.className = 'progress-dot';
    if (index === 0) dot.classList.add('active');
  });
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  // Enable Enter key for search
  document.getElementById('queryInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') startAnalysis();
  });
  
  // Database is already loaded, just update status
  console.log("Krishi Beej Ecological AI Ready!");
});
</script>
</body>
</html>
