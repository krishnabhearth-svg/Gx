<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ðŸŒ± Krishi AI â€¢ Semantic Ecological Search</title>
<style>
body{font-family:Arial,sans-serif;background:#f9f9f9;color:#222;margin:0;padding:0;text-align:center;}
.container{max-width:900px;margin:20px auto;padding:20px;}
input{width:90%;max-width:500px;padding:14px;border:1px solid #ccc;border-radius:24px;font-size:1em;margin:15px 0;}
.tabs{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin:15px 0;}
.tab{padding:8px 16px;background:#e0e0e0;border:none;border-radius:20px;cursor:pointer;font-size:0.85em;}
.tab.active{background:#4CAF50;color:white;}
.panel{display:none;text-align:left;background:white;padding:15px;margin:15px 0;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.panel.active{display:block;}
.actions{background:#e8f5e8;padding:15px;border-radius:10px;margin:20px 0;text-align:left;}
.actions span{display:inline-block;background:white;padding:6px 12px;margin:4px 6px 4px 0;border-radius:16px;font-size:0.85em;}
.log{font-size:0.75em;color:#777;font-style:italic;margin-top:10px;}
</style>
</head>
<body>
<div class="container">
  <h1>ðŸŒ± Krishi AI â€¢ Semantic Search</h1>
  <input type="text" id="userQuery" placeholder="e.g., organic farming, mental calm, pollution vehicle..." oninput="handleInput()">
  
  <div id="aiOutput" style="display:none;">
    <div class="actions">
      <strong>Recommended Actions:</strong><br>
      <div id="actionList"></div>
    </div>
    <p><strong>Intelligent Questions:</strong></p>
    <div id="questionList"></div>
  </div>

  <div class="tabs" id="tabs"></div>
  <div id="panels"></div>

  <div class="log" id="logMessage"></div>
</div>

<script>
// Load the semantic vector database
let semanticDB = {};
let currentMatch = null;
let userKeyword = '';

// Simulate loading JSON (in real use, fetch from file)
async function loadSemanticDB() {
  // In production: const res = await fetch('semantic-vector-db.json');
  // For demo, embed small version
  semanticDB = {
    "organic farming": {
      "vector": [0.88, 0.95, 0.74],
      "questions": ["Home garden or farm?", "Need certification help?"],
      "queries": {
        "google": "organic farming soil health biodiversity",
        "scholar": "organic agriculture yield study",
        "youtube": "organic farming for beginners India",
        "maps": "organic farms near me"
      },
      "actions": ["Visit organic farm", "Start small garden", "Test soil"],
      "trusted_sites": ["soilhealth.dac.gov.in", "krishi.gov.in"]
    },
    "pollution vehicle": {
      "vector": [0.85, 0.72, 0.79],
      "questions": ["Health or environment concern?", "City or rural?"],
      "queries": {
        "google": "vehicle pollution air quality health",
        "scholar": "transport emissions climate impact",
        "youtube": "reduce car pollution tips",
        "maps": "EV charging stations near me"
      },
      "actions": ["Use public transport", "Calculate carbon footprint"],
      "trusted_sites": ["cpcb.nic.in", "ev.gov.in"]
    },
    "mental calm": {
      "vector": [0.65, 0.92, 0.71],
      "questions": ["Individual or group practice?", "Daily time available?"],
      "queries": {
        "google": "nature therapy mental calm",
        "scholar": "grounding mental health study",
        "youtube": "5 minute mindfulness grounding",
        "maps": "meditation centers near me"
      },
      "actions": ["Walk barefoot on soil", "Grow tulsi at home"],
      "trusted_sites": ["nih.gov", "who.int"]
    }
  };
}

function findBestMatch(query) {
  query = query.toLowerCase();
  for (let term in semanticDB) {
    if (query.includes(term) || term.includes(query)) {
      return semanticDB[term];
    }
  }
  // Fallback: return first match by keyword overlap
  for (let term in semanticDB) {
    if (term.split(' ').some(w => query.includes(w))) {
      return semanticDB[term];
    }
  }
  return null;
}

function handleInput() {
  const q = document.getElementById('userQuery').value.trim();
  if (!q) {
    document.getElementById('aiOutput').style.display = 'none';
    return;
  }
  
  userKeyword = q;
  currentMatch = findBestMatch(q);
  
  if (currentMatch) {
    // Show actions
    document.getElementById('actionList').innerHTML = 
      currentMatch.actions.map(a => `<span>${a}</span>`).join('');
    
    // Show questions
    document.getElementById('questionList').innerHTML = 
      currentMatch.questions.map(q => `<p>â€¢ ${q}</p>`).join('');
    
    document.getElementById('aiOutput').style.display = 'block';
    
    // Generate tabs & panels
    generateTabsAndPanels();
    
    // Log for research
    logSearch(q, currentMatch);
    
  } else {
    document.getElementById('aiOutput').style.display = 'none';
    document.getElementById('tabs').innerHTML = '';
    document.getElementById('panels').innerHTML = '';
    document.getElementById('logMessage').textContent = 'No semantic match found â€“ using basic search.';
  }
}

function generateTabsAndPanels() {
  const tabsContainer = document.getElementById('tabs');
  const panelsContainer = document.getElementById('panels');
  
  const platforms = ["google", "scholar", "youtube", "maps", "news", "wiki"];
  tabsContainer.innerHTML = '';
  panelsContainer.innerHTML = '';
  
  platforms.forEach(platform => {
    const isActive = platform === "google";
    
    // Create tab
    const tab = document.createElement('button');
    tab.className = `tab ${isActive ? 'active' : ''}`;
    tab.textContent = platform.charAt(0).toUpperCase() + platform.slice(1);
    tab.onclick = () => switchTab(platform);
    tab.dataset.target = platform;
    tabsContainer.appendChild(tab);
    
    // Create panel
    const panel = document.createElement('div');
    panel.id = platform;
    panel.className = `panel ${isActive ? 'active' : ''}`;
    panel.innerHTML = `<h3>${platform.charAt(0).toUpperCase() + platform.slice(1)}</h3><div id="${platform}Link"></div>`;
    panelsContainer.appendChild(panel);
    
    // Generate link
    const finalQuery = currentMatch.queries[platform] || `${userKeyword} ecology agriculture sustainable`;
    const urls = {
      google: `https://www.google.com/search?q=${encodeURIComponent(finalQuery)}`,
      scholar: `https://scholar.google.com/scholar?q=${encodeURIComponent(finalQuery)}`,
      youtube: `https://www.youtube.com/results?search_query=${encodeURIComponent(finalQuery)}`,
      maps: `https://www.google.com/maps/search/${encodeURIComponent(finalQuery)}`,
      news: `https://news.google.com/search?q=${encodeURIComponent(finalQuery)}`,
      wiki: `https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(finalQuery)}`
    };
    
    document.getElementById(`${platform}Link`).innerHTML = 
      `<a href="${urls[platform]}" target="_blank">${platform} results for: ${finalQuery}</a>`;
  });
}

function switchTab(platform) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelector(`.tab[data-target="${platform}"]`).classList.add('active');
  document.getElementById(platform).classList.add('active');
}

function logSearch(keyword, match) {
  // In real app: send to backend or store in IndexedDB
  const logEntry = {
    timestamp: new Date().toISOString(),
    keyword: keyword,
    matched_concept: Object.keys(semanticDB).find(k => semanticDB[k] === match),
    actions_shown: match.actions,
    queries_used: match.queries
  };
  
  // Save to localStorage for research (optional)
  let logs = JSON.parse(localStorage.getItem('krishi_search_logs') || '[]');
  logs.push(logEntry);
  localStorage.setItem('krishi_search_logs', JSON.stringify(logs.slice(-100))); // keep last 100
  
  document.getElementById('logMessage').textContent = 
    `âœ… Logged: "${keyword}" â†’ matched concept. (${logs.length} total searches stored)`;
}

// Initialize
loadSemanticDB().then(() => {
  document.getElementById('logMessage').textContent = 'Semantic DB loaded. Ready for intelligent search.';
});
</script>
</body>
</html>
