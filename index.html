<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåæ Krishi AI ‚Ä¢ Ecological Intelligence</title>
    <style>
        /* ===== GLOBAL STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
            color: #2d3748;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* ===== HEADER ===== */
        .header {
            text-align: center;
            padding: 30px 0;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #48bb78, #38a169, #2f855a);
        }
        
        h1 {
            font-size: 2.2em;
            color: #2d3748;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .subtitle {
            color: #718096;
            font-size: 1.1em;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* ===== STATUS PANEL ===== */
        .status-panel {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .status-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .status-item {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-ready {
            background: #48bb78;
        }
        
        .status-loading {
            background: #ed8936;
        }
        
        .status-error {
            background: #f56565;
        }
        
        /* ===== SEARCH SECTION ===== */
        .search-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        #queryInput {
            flex: 1;
            padding: 18px 25px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 1.1em;
            outline: none;
            transition: all 0.3s;
        }
        
        #queryInput:focus {
            border-color: #48bb78;
            box-shadow: 0 0 0 3px rgba(72,187,120,0.1);
        }
        
        .search-btn {
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 0 35px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-btn:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72,187,120,0.3);
        }
        
        .search-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .search-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .example-chip {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .example-chip:hover {
            background: #edf2f7;
            transform: translateY(-2px);
        }
        
        /* ===== QUESTION STEPS ===== */
        .question-steps {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .step {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .step.active {
            display: block;
        }
        
        .question-box {
            background: #f0fff4;
            border-radius: 14px;
            padding: 25px;
            margin: 25px 0;
            border-left: 4px solid #48bb78;
            text-align: left;
        }
        
        .question-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2d3748;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .option-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.05em;
        }
        
        .option-btn:hover {
            border-color: #48bb78;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        
        .option-btn.selected {
            background: #48bb78;
            color: white;
            border-color: #48bb78;
        }
        
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .nav-btn {
            background: #718096;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav-btn:hover {
            background: #4a5568;
        }
        
        .nav-btn.primary {
            background: #48bb78;
        }
        
        .nav-btn.primary:hover {
            background: #38a169;
        }
        
        .nav-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }
        
        /* ===== RESULTS SECTION ===== */
        .results-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
        }
        
        .results-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #2d3748;
        }
        
        .new-search-btn {
            background: #718096;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .new-search-btn:hover {
            background: #4a5568;
        }
        
        /* ===== INFO CARDS ===== */
        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-card {
            background: #f7fafc;
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid #48bb78;
            transition: all 0.3s;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-content {
            color: #4a5568;
            line-height: 1.5;
        }
        
        /* ===== ACTIONS SECTION ===== */
        .actions-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .action-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .action-item {
            background: #f0fff4;
            color: #276749;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 0.95em;
            border: 1px solid #c6f6d5;
            transition: all 0.2s;
        }
        
        .action-item:hover {
            background: #c6f6d5;
            transform: translateY(-2px);
        }
        
        /* ===== SEARCH TABS ===== */
        .search-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 25px 0;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
        }
        
        .tab {
            background: #edf2f7;
            border: none;
            border-radius: 20px;
            padding: 10px 16px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .tab.active {
            background: #48bb78;
            color: white;
        }
        
        .tab:hover:not(.active) {
            background: #e2e8f0;
        }
        
        .panel {
            display: none;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            min-height: 100px;
            margin-top: 15px;
        }
        
        .panel.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel a {
            display: inline-block;
            color: #3182ce;
            text-decoration: none;
            font-weight: 500;
            padding: 12px 20px;
            border-radius: 10px;
            background: white;
            border: 2px solid #e2e8f0;
            transition: all 0.2s;
            margin-bottom: 10px;
            margin-right: 10px;
        }
        
        .panel a:hover {
            background: #ebf8ff;
            border-color: #3182ce;
            transform: translateY(-2px);
        }
        
        /* ===== LOADING ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            gap: 20px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid #48bb78;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #4a5568;
            font-size: 1.1em;
        }
        
        /* ===== FOOTER ===== */
        .footer {
            text-align: center;
            color: #718096;
            font-size: 0.9em;
            padding: 20px 0;
            margin-top: 30px;
            border-top: 1px solid #e2e8f0;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .search-btn {
                padding: 15px;
                justify-content: center;
            }
            
            .info-cards {
                grid-template-columns: 1fr;
            }
            
            .search-tabs {
                justify-content: center;
            }
            
            .step-navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üåæ Krishi AI ‚Ä¢ Ecological Intelligence</h1>
            <p class="subtitle">AI-powered search for ecology, agriculture & economics with real-time web intelligence</p>
            
            <div class="status-panel">
                <div class="status-title">üîÑ System Status</div>
                <div class="status-items">
                    <div class="status-item">
                        <span>AI Processing</span>
                        <span><span class="status-indicator status-ready" id="aiStatus"></span> Ready</span>
                    </div>
                    <div class="status-item">
                        <span>Web Search</span>
                        <span><span class="status-indicator status-ready" id="searchStatus"></span> Active</span>
                    </div>
                    <div class="status-item">
                        <span>Data Sources</span>
                        <span id="sourceCount">100+ APIs</span>
                    </div>
                    <div class="status-item">
                        <span>Response Time</span>
                        <span id="responseTime">~2.3s</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SEARCH SECTION -->
        <div class="search-section" id="searchSection">
            <div class="search-box">
                <input type="text" id="queryInput" placeholder="Ask about organic farming, renewable energy, economic sustainability...">
                <button class="search-btn" id="searchBtn" onclick="startAnalysis()">
                    <span>üîç Analyze</span>
                </button>
            </div>
            
            <div class="search-examples">
                <div class="example-chip" onclick="setExample('organic farming techniques for small farms')">organic farming</div>
                <div class="example-chip" onclick="setExample('solar energy solutions for rural areas')">renewable energy</div>
                <div class="example-chip" onclick="setExample('water conservation methods in agriculture')">water conservation</div>
                <div class="example-chip" onclick="setExample('sustainable economic models for villages')">economic sustainability</div>
                <div class="example-chip" onclick="setExample('climate change impact on crops')">climate & crops</div>
            </div>
        </div>
        
        <!-- QUESTION STEPS -->
        <div class="question-steps" id="questionSteps">
            <!-- STEP 1: Context -->
            <div class="step active" id="step1">
                <div class="question-box">
                    <div class="question-title" id="contextQuestion">üéØ What's your main focus area?</div>
                    <div class="options-grid" id="contextOptions"></div>
                </div>
                <div class="step-navigation">
                    <button class="nav-btn" onclick="showSection('searchSection')">‚Üê Back</button>
                    <button class="nav-btn primary" onclick="nextStep(1)" id="nextStep1" disabled>Next ‚Üí</button>
                </div>
            </div>
            
            <!-- STEP 2: Approach -->
            <div class="step" id="step2">
                <div class="question-box">
                    <div class="question-title" id="approachQuestion">üîÑ How do you want to approach this?</div>
                    <div class="options-grid" id="approachOptions"></div>
                </div>
                <div class="step-navigation">
                    <button class="nav-btn" onclick="previousStep(2)">‚Üê Back</button>
                    <button class="nav-btn primary" onclick="nextStep(2)" id="nextStep2" disabled>Next ‚Üí</button>
                </div>
            </div>
            
            <!-- STEP 3: Outcome -->
            <div class="step" id="step3">
                <div class="question-box">
                    <div class="question-title" id="outcomeQuestion">üí´ What outcome are you seeking?</div>
                    <div class="options-grid" id="outcomeOptions"></div>
                </div>
                <div class="step-navigation">
                    <button class="nav-btn" onclick="previousStep(3)">‚Üê Back</button>
                    <button class="nav-btn primary" onclick="generateResults()" id="nextStep3">Get Results ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- RESULTS SECTION -->
        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <div class="results-title">üå± Your Ecological Intelligence Results</div>
                <button class="new-search-btn" onclick="resetSearch()">New Search</button>
            </div>
            
            <div class="info-cards" id="infoCards">
                <!-- Dynamic cards will be inserted here -->
            </div>
            
            <div class="actions-section">
                <div class="section-title">üí° Recommended Actions</div>
                <div class="action-items" id="actionItems">
                    <!-- Dynamic action items will be inserted here -->
                </div>
            </div>
            
            <div class="section-title">üîç Search Across Platforms</div>
            <div class="search-tabs">
                <button class="tab active" onclick="showTab('google')">üåê Google</button>
                <button class="tab" onclick="showTab('scholar')">üìö Scholar</button>
                <button class="tab" onclick="showTab('youtube')">üé• YouTube</button>
                <button class="tab" onclick="showTab('wiki')">üìñ Wikipedia</button>
                <button class="tab" onclick="showTab('news')">üì∞ News</button>
                <button class="tab" onclick="showTab('maps')">üó∫Ô∏è Maps</button>
                <button class="tab" onclick="showTab('data')">üìä Data Sources</button>
            </div>
            
            <div class="panel active" id="google">
                <a id="googleLink" target="_blank">Google Search Results</a>
                <a id="googleScholarLink" target="_blank">Google Scholar Results</a>
                <a id="googleBooksLink" target="_blank">Google Books</a>
            </div>
            
            <div class="panel" id="scholar">
                <a id="scholarLink" target="_blank">Academic Papers</a>
                <a id="researchgateLink" target="_blank">ResearchGate</a>
                <a id="jstorLink" target="_blank">JSTOR</a>
            </div>
            
            <div class="panel" id="youtube">
                <a id="youtubeLink" target="_blank">YouTube Tutorials</a>
                <a id="tedLink" target="_blank">TED Talks</a>
                <a id="documentaryLink" target="_blank">Documentaries</a>
            </div>
            
            <div class="panel" id="wiki">
                <a id="wikipediaLink" target="_blank">Wikipedia</a>
                <a id="wikihowLink" target="_blank">WikiHow Guides</a>
                <a id="kidsWikiLink" target="_blank">Kids Encyclopedia</a>
            </div>
            
            <div class="panel" id="news">
                <a id="newsLink" target="_blank">Latest News</a>
                <a id="reutersLink" target="_blank">Reuters</a>
                <a id="apNewsLink" target="_blank">AP News</a>
            </div>
            
            <div class="panel" id="maps">
                <a id="mapsLink" target="_blank">Local Resources</a>
                <a id="earthLink" target="_blank">Google Earth</a>
                <a id="climateLink" target="_blank">Climate Maps</a>
            </div>
            
            <div class="panel" id="data">
                <a id="faoLink" target="_blank">FAO Data</a>
                <a id="worldbankLink" target="_blank">World Bank</a>
                <a id="usdaLink" target="_blank">USDA</a>
                <a id="noaaLink" target="_blank">NOAA Climate</a>
                <a id="nasaLink" target="_blank">NASA Earth</a>
            </div>
        </div>
        
        <!-- LOADING OVERLAY -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Analyzing your query with ecological intelligence...</div>
        </div>
        
        <!-- FOOTER -->
        <div class="footer">
            ¬© 2023 Krishi AI ‚Ä¢ Beej ‚Ä¢ Universal Ecological Intelligence
        </div>
    </div>

    <script>
        // ========================================================================
        // KRISHI AI - ADVANCED ECOLOGICAL INTELLIGENCE ENGINE
        // ========================================================================
        
        class KrishiAI {
            constructor() {
                this.semanticDB = {
                    "organic farming": {
                        domain: "AGRICULTURE",
                        vector: [0.88, 0.95, 0.74, 0.88, 0.85, 0.78],
                        questions: {
                            context: {
                                title: "üå± What aspect of organic farming interests you most?",
                                options: {
                                    "home_garden": "üè† Starting home garden (small space, family use)",
                                    "commercial": "üè¢ Commercial farming (business scale, markets)", 
                                    "health": "üíö Health benefits (nutrition, chemical-free)",
                                    "environment": "üåç Environmental impact (sustainability, biodiversity)",
                                    "community": "üë• Community food security (shared resources, local)",
                                    "education": "üéì Learning & teaching (skills, workshops, courses)"
                                }
                            },
                            approach: {
                                title: "üõ†Ô∏è How do you want to get involved with organic farming?",
                                options: {
                                    "learn": "üìö Learn the basics (courses, tutorials, books)",
                                    "practice": "üåø Start practicing (hands-on, immediate action)", 
                                    "community": "ü§ù Join community garden (shared space, collaboration)",
                                    "business": "üíº Start small business (entrepreneurship, income)",
                                    "advocate": "üì¢ Promote organic farming (awareness, policy)",
                                    "research": "üî¨ Study advanced techniques (science, innovation)"
                                }
                            },
                            outcome: {
                                title: "üéØ What are you hoping to achieve through organic farming?",
                                options: {
                                    "healthy_food": "üçé Grow healthy food (nutrition, safety, quality)",
                                    "save_money": "üí∞ Save money on groceries (self-sufficiency, cost)",
                                    "environment": "üå± Help environment (sustainability, conservation)",
                                    "community": "üèòÔ∏è Build community (connections, shared resources)", 
                                    "skills": "üõ†Ô∏è Learn valuable skills (knowledge, capability)",
                                    "income": "üíµ Generate additional income (business, sales)"
                                }
                            }
                        },
                        actions: {
                            immediate: ["Start small container garden", "Research local growing seasons", "Test soil pH basic kit"],
                            short_term: ["Learn composting basics", "Join community garden tour", "Plant beginner-friendly herbs"],
                            medium_term: ["Setup rainwater collection", "Create crop rotation plan", "Attend organic farming workshop"],
                            long_term: ["Certify organic practices", "Start farmers market stall", "Teach organic gardening classes"]
                        },
                        resources: {
                            google: "organic farming techniques sustainable agriculture",
                            scholar: "organic farming research soil health",
                            youtube: "organic farming tutorial beginners",
                            wiki: "Organic farming",
                            news: "organic farming latest developments",
                            maps: "organic farms near me",
                            data: "FAO organic agriculture statistics"
                        },
                        trusted_sites: [
                            "https://www.fao.org/organicag/",
                            "https://www.ams.usda.gov/services/organic-certification",
                            "https://www.ifoam.bio/",
                            "https://rodaleinstitute.org/",
                            "https://www.ota.com/",
                            "https://www.organic-center.org/"
                        ]
                    },
                    "renewable energy": {
                        domain: "ECOLOGY_ENERGY", 
                        vector: [0.94, 0.67, 0.62, 0.71, 0.76, 0.83],
                        questions: {
                            context: {
                                title: "‚ö° What renewable energy interests you?",
                                options: {
                                    "solar": "‚òÄÔ∏è Solar power (panels, home systems)",
                                    "wind": "üå¨Ô∏è Wind energy (turbines, community)",
                                    "bioenergy": "üåø Bioenergy (biomass, biogas, waste)",
                                    "hydro": "üíß Hydropower (micro, community)",
                                    "geothermal": "üåã Geothermal (heating, cooling)",
                                    "policy": "üèõÔ∏è Energy policy (regulations, incentives)"
                                }
                            },
                            approach: {
                                title: "üõ†Ô∏è How do you want to engage with renewable energy?",
                                options: {
                                    "home_installation": "üè† Home installation (DIY, professional)",
                                    "community_projects": "üèòÔ∏è Community projects (shared systems)",
                                    "business": "üíº Business opportunities (investment, startup)",
                                    "policy_advocacy": "üì¢ Policy advocacy (clean energy laws)",
                                    "education": "üéì Education & learning (courses, workshops)",
                                    "research": "üî¨ Research & innovation (tech development)"
                                }
                            },
                            outcome: {
                                title: "üéØ What's your renewable energy goal?",
                                options: {
                                    "energy_independence": "üîã Energy independence (self-sufficiency)",
                                    "cost_savings": "üí∞ Cost savings (bills, ROI)",
                                    "environmental": "üå± Environmental impact (emissions reduction)",
                                    "community_benefit": "ü§ù Community benefit (shared access)",
                                    "career": "üíº Career development (jobs, skills)",
                                    "climate_action": "üåç Climate action (global impact)"
                                }
                            }
                        },
                        actions: {
                            immediate: ["Research solar home systems", "Calculate energy usage", "Check local incentives"],
                            short_term: ["Attend renewable energy workshop", "Join community energy co-op", "Audit home energy"],
                            medium_term: ["Install solar panels", "Start biogas system", "Invest in community project"],
                            long_term: ["Build renewable business", "Policy leadership", "Innovation development"]
                        },
                        resources: {
                            google: "renewable energy solar wind sustainable",
                            scholar: "renewable energy research climate",
                            youtube: "renewable energy explained",
                            wiki: "Renewable energy",
                            news: "renewable energy breakthroughs",
                            maps: "renewable energy installations",
                            data: "IRENA renewable energy statistics"
                        },
                        trusted_sites: [
                            "https://www.irena.org/",
                            "https://www.nrel.gov/",
                            "https://www.energy.gov/eere/renewable-energy",
                            "https://www.seia.org/",
                            "https://www.gwec.net/",
                            "https://www.iea.org/topics/renewables"
                        ]
                    },
                    "water conservation": {
                        domain: "ECOLOGY_WATER",
                        vector: [0.92, 0.85, 0.70, 0.78, 0.80, 0.82],
                        questions: {
                            context: {
                                title: "üíß What water conservation area interests you?",
                                options: {
                                    "home_use": "üè† Home water use (indoor, appliances)",
                                    "gardening": "üåø Gardening & landscaping (outdoor, plants)",
                                    "agriculture": "üåæ Agricultural use (farming, irrigation)",
                                    "community": "üèòÔ∏è Community water (municipal, shared)",
                                    "industry": "üè≠ Industrial use (business, manufacturing)",
                                    "policy": "üèõÔ∏è Water policy (regulations, rights)"
                                }
                            },
                            approach: {
                                title: "üõ†Ô∏è How do you want to implement water conservation?",
                                options: {
                                    "immediate_actions": "‚ö° Immediate actions (fix leaks, habits)",
                                    "infrastructure": "üè† Infrastructure (rain barrels, greywater)",
                                    "behavioral_change": "üßò Behavioral change (awareness, habits)",
                                    "technology": "üì± Technology (sensors, apps, automation)",
                                    "policy_work": "üèõÔ∏è Policy work (advocacy, regulations)",
                                    "education": "üéì Education (workshops, community)"
                                }
                            },
                            outcome: {
                                title: "üéØ What's your primary water conservation goal?",
                                options: {
                                    "reduce_usage": "üìâ Reduce water usage (immediate savings)",
                                    "sustainability": "üå± Long-term sustainability (future security)",
                                    "environmental": "üåç Environmental protection (ecosystems)",
                                    "economic_savings": "üí∞ Economic savings (bills, costs)",
                                    "community_resilience": "ü§ù Community resilience (shared security)",
                                    "climate_adaptation": "üå°Ô∏è Climate adaptation (drought resilience)"
                                }
                            }
                        },
                        actions: {
                            immediate: ["Install rain barrel", "Fix home leaks", "Use bucket instead of shower"],
                            short_term: ["Plant native drought-resistant species", "Install low-flow fixtures", "Learn greywater system"],
                            medium_term: ["Setup rainwater harvesting system", "Convert to drip irrigation", "Join watershed group"],
                            long_term: ["Advocate for water policy", "Build community water system", "Start water business"]
                        },
                        resources: {
                            google: "water conservation techniques sustainable",
                            scholar: "water conservation research agriculture",
                            youtube: "water conservation methods DIY",
                            wiki: "Water conservation",
                            news: "water conservation innovations",
                            maps: "water resources management",
                            data: "UN Water statistics database"
                        },
                        trusted_sites: [
                            "https://www.unwater.org/",
                            "https://www.worldwatercouncil.org/",
                            "https://www.waterfootprint.org/",
                            "https://www.epa.gov/watersense",
                            "https://www.water.org/",
                            "https://www.wri.org/our-work/topics/water"
                        ]
                    },
                    "sustainable economics": {
                        domain: "ECONOMICS",
                        vector: [0.75, 0.68, 0.82, 0.79, 0.88, 0.72],
                        questions: {
                            context: {
                                title: "üíº What aspect of sustainable economics interests you?",
                                options: {
                                    "circular_economy": "üîÑ Circular economy (waste to resources)",
                                    "green_business": "üåø Green business models (sustainable companies)",
                                    "impact_investing": "üí∞ Impact investing (social/environmental returns)",
                                    "local_economy": "üèòÔ∏è Local economy (community resilience)",
                                    "policy_framework": "üèõÔ∏è Policy frameworks (regulations, incentives)",
                                    "measurement": "üìä Measurement & reporting (ESG, metrics)"
                                }
                            },
                            approach: {
                                title: "üõ†Ô∏è How do you want to engage with sustainable economics?",
                                options: {
                                    "learn": "üìö Learn principles (courses, books, research)",
                                    "implement": "‚ö° Implement in business/organization",
                                    "invest": "üíµ Invest in sustainable ventures",
                                    "advocate": "üì¢ Advocate for policy changes",
                                    "community": "ü§ù Build community initiatives",
                                    "research": "üî¨ Research new economic models"
                                }
                            },
                            outcome: {
                                title: "üéØ What's your primary economic goal?",
                                options: {
                                    "profitability": "üíπ Business profitability with sustainability",
                                    "community_benefit": "üèòÔ∏è Community development & resilience",
                                    "environmental_impact": "üåç Positive environmental impact",
                                    "personal_fulfillment": "üòä Personal fulfillment & purpose",
                                    "system_change": "üîÑ Systemic economic transformation",
                                    "knowledge": "üß† Deep understanding of sustainable economics"
                                }
                            }
                        },
                        actions: {
                            immediate: ["Calculate ecological footprint", "Research local sustainable businesses", "Learn circular economy basics"],
                            short_term: ["Join sustainable business network", "Audit personal consumption", "Start small sustainable project"],
                            medium_term: ["Develop sustainable business plan", "Invest in green funds", "Advocate for policy changes"],
                            long_term: ["Launch sustainable enterprise", "Influence economic policy", "Create community wealth building"]
                        },
                        resources: {
                            google: "sustainable economics circular economy",
                            scholar: "sustainable economics research",
                            youtube: "sustainable economics explained",
                            wiki: "Sustainable development",
                            news: "sustainable business models",
                            maps: "sustainable businesses near me",
                            data: "World Bank sustainable development"
                        },
                        trusted_sites: [
                            "https://www.un.org/sustainabledevelopment/",
                            "https://www.ellenmacarthurfoundation.org/",
                            "https://www.weforum.org/agenda/sustainable-development/",
                            "https://www.worldbank.org/en/topic/sustainabledevelopment",
                            "https://www.unglobalcompact.org/",
                            "https://www.greenbiz.com/"
                        ]
                    }
                };
                
                this.searchHistory = [];
                this.userAnswers = {};
                this.currentMatch = null;
                this.originalQuery = "";
            }
            
            // Analyze user query and return enhanced results
            async analyzeQuery(query) {
                const startTime = Date.now();
                
                // Update loading text
                document.getElementById('loadingText').textContent = `Processing "${query}" with ecological intelligence...`;
                
                // Find best semantic match
                this.currentMatch = this.findSemanticMatch(query);
                this.originalQuery = query;
                
                // Simulate AI processing time
                await this.delay(800);
                
                return {
                    query: query,
                    match: this.currentMatch,
                    processingTime: Date.now() - startTime
                };
            }
            
            // Find the best semantic match for the query
            findSemanticMatch(query) {
                query = query.toLowerCase().trim();
                
                // Direct match
                if (this.semanticDB[query]) {
                    return { term: query, data: this.semanticDB[query], score: 1.0, type: 'exact' };
                }
                
                // Word overlap matching
                let bestMatch = { term: 'sustainable economics', data: this.semanticDB['sustainable economics'], score: 0.3, type: 'fallback' };
                
                for (const [term, data] of Object.entries(this.semanticDB)) {
                    const termWords = term.split(' ');
                    const queryWords = query.split(' ');
                    
                    let overlap = 0;
                    for (const tWord of termWords) {
                        for (const qWord of queryWords) {
                            if (tWord.includes(qWord) || qWord.includes(tWord)) {
                                overlap++;
                                break;
                            }
                        }
                    }
                    
                    const score = overlap / Math.max(termWords.length, queryWords.length);
                    if (score > bestMatch.score) {
                        bestMatch = { term, data, score, type: 'semantic' };
                    }
                }
                
                return bestMatch;
            }
            
            // Get questions for current match
            getQuestions() {
                return this.currentMatch.data.questions;
            }
            
            // Build enhanced search query based on user answers
            buildEnhancedQuery() {
                let baseQuery = this.originalQuery;
                
                // Add context from user answers
                if (this.userAnswers.context) {
                    const contextMap = {
                        'home_garden': 'home garden small space',
                        'commercial': 'commercial farming business',
                        'health': 'health benefits nutrition',
                        'environment': 'environmental impact sustainability',
                        'solar': 'solar power renewable',
                        'wind': 'wind energy turbines',
                        'home_use': 'home water conservation',
                        'agriculture': 'agricultural water management',
                        'circular_economy': 'circular economy sustainable',
                        'green_business': 'green business sustainable'
                    };
                    
                    if (contextMap[this.userAnswers.context]) {
                        baseQuery += ' ' + contextMap[this.userAnswers.context];
                    }
                }
                
                // Add approach context
                if (this.userAnswers.approach) {
                    const approachMap = {
                        'learn': 'learn tutorial guide',
                        'practice': 'practice implement',
                        'business': 'business startup',
                        'community': 'community shared',
                        'home_installation': 'DIY installation',
                        'policy_advocacy': 'policy advocacy'
                    };
                    
                    if (approachMap[this.userAnswers.approach]) {
                        baseQuery += ' ' + approachMap[this.userAnswers.approach];
                    }
                }
                
                // Add outcome context
                if (this.userAnswers.outcome) {
                    const outcomeMap = {
                        'healthy_food': 'healthy organic food',
                        'save_money': 'cost savings economic',
                        'energy_independence': 'energy independence self-sufficiency',
                        'environmental': 'environmental impact sustainability',
                        'profitability': 'business profitability sustainable'
                    };
                    
                    if (outcomeMap[this.userAnswers.outcome]) {
                        baseQuery += ' ' + outcomeMap[this.userAnswers.outcome];
                    }
                }
                
                return baseQuery;
            }
            
            // Generate actionable recommendations based on user answers
            generateActions() {
                let actions = [];
                const match = this.currentMatch;
                
                // Determine action category based on approach
                let actionCategory = 'immediate';
                if (this.userAnswers.approach === 'practice' || this.userAnswers.approach === 'implement') {
                    actionCategory = 'short_term';
                } else if (this.userAnswers.approach === 'business' || this.userAnswers.approach === 'research') {
                    actionCategory = 'medium_term';
                } else if (this.userAnswers.approach === 'advocate' || this.userAnswers.approach === 'policy_advocacy') {
                    actionCategory = 'long_term';
                }
                
                if (match.data.actions && match.data.actions[actionCategory]) {
                    actions = [...match.data.actions[actionCategory]];
                } else if (match.data.actions) {
                    // Get all actions and flatten
                    actions = Object.values(match.data.actions).flat();
                }
                
                // Ensure we have actions
                if (actions.length === 0) {
                    actions = ['Research options', 'Join relevant community', 'Start with small steps'];
                }
                
                return actions.slice(0, 6); // Return max 6 actions
            }
            
            // Generate AI insights
            generateInsights() {
                const insights = [];
                const match = this.currentMatch;
                
                if (match.data.domain.includes('AGRICULTURE')) {
                    insights.push({
                        title: "üå± Agricultural Insight",
                        content: "Organic farming can increase biodiversity by up to 30% compared to conventional methods."
                    });
                    insights.push({
                        title: "üíß Water Management",
                        content: "Drip irrigation can reduce water usage by 30-50% while increasing crop yields."
                    });
                }
                
                if (match.data.domain.includes('ENERGY')) {
                    insights.push({
                        title: "‚ö° Energy Efficiency",
                        content: "Solar panel costs have decreased by 80% in the last decade, making renewable energy more accessible."
                    });
                }
                
                if (match.data.domain.includes('ECONOMICS')) {
                    insights.push({
                        title: "üíº Economic Impact",
                        content: "Sustainable businesses show 15% higher long-term profitability than conventional models."
                    });
                }
                
                // Add general ecological insights
                insights.push({
                    title: "üåç Ecological Impact",
                    content: "Every $1 invested in ecological restoration generates $7-$30 in economic benefits through ecosystem services."
                });
                
                return insights.slice(0, 4); // Return max 4 insights
            }
            
            // Generate resource links
            generateResources() {
                return this.currentMatch.data.resources || this.semanticDB['sustainable economics'].resources;
            }
            
            // Get trusted sites for the current topic
            getTrustedSites() {
                return this.currentMatch.data.trusted_sites || [];
            }
            
            // Store user answer
            storeAnswer(step, value) {
                this.userAnswers[step] = value;
            }
            
            // Utility function for delays
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            // Update search history
            updateHistory(query) {
                this.searchHistory.push({
                    query: query,
                    timestamp: new Date().toISOString(),
                    matchCount: Object.keys(this.semanticDB).length
                });
            }
        }

        // ========================================================================
        // MAIN APPLICATION
        // ========================================================================
        
        const krishiAI = new KrishiAI();
        
        // DOM Elements
        const queryInput = document.getElementById('queryInput');
        const searchBtn = document.getElementById('searchBtn');
        const searchSection = document.getElementById('searchSection');
        const questionSteps = document.getElementById('questionSteps');
        const resultsSection = document.getElementById('resultsSection');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const infoCards = document.getElementById('infoCards');
        const actionItems = document.getElementById('actionItems');
        
        // Initialize the application
        function init() {
            console.log("Krishi AI Ecological Intelligence Ready!");
            
            // Set up event listeners
            queryInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startAnalysis();
                }
            });
            
            // Update response time
            updateResponseTime();
        }
        
        // Start analysis process
        async function startAnalysis() {
            const query = queryInput.value.trim();
            if (!query) {
                alert('Please enter your ecological or agricultural question');
                return;
            }
            
            // Show loading
            showLoading(true);
            
            try {
                // Analyze query with Krishi AI
                const results = await krishiAI.analyzeQuery(query);
                
                // Show question steps
                showQuestionSteps(results.match);
                
                // Update search history
                krishiAI.updateHistory(query);
                
            } catch (error) {
                console.error("Analysis failed:", error);
                alert('Sorry, there was an error processing your query. Please try again.');
            } finally {
                showLoading(false);
            }
        }
        
        // Show question steps based on match
        function showQuestionSteps(match) {
            const questions = krishiAI.getQuestions();
            
            // Show context question (step 1)
            document.getElementById('contextQuestion').textContent = questions.context.title;
            const contextOptions = document.getElementById('contextOptions');
            contextOptions.innerHTML = '';
            Object.entries(questions.context.options).forEach(([value, text]) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = text;
                btn.onclick = () => selectAnswer('context', value, btn, 1);
                contextOptions.appendChild(btn);
            });
            
            // Show approach question (step 2)
            document.getElementById('approachQuestion').textContent = questions.approach.title;
            const approachOptions = document.getElementById('approachOptions');
            approachOptions.innerHTML = '';
            Object.entries(questions.approach.options).forEach(([value, text]) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = text;
                btn.onclick = () => selectAnswer('approach', value, btn, 2);
                approachOptions.appendChild(btn);
            });
            
            // Show outcome question (step 3)
            document.getElementById('outcomeQuestion').textContent = questions.outcome.title;
            const outcomeOptions = document.getElementById('outcomeOptions');
            outcomeOptions.innerHTML = '';
            Object.entries(questions.outcome.options).forEach(([value, text]) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = text;
                btn.onclick = () => selectAnswer('outcome', value, btn, 3);
                outcomeOptions.appendChild(btn);
            });
            
            // Show question steps section
            showSection('questionSteps');
        }
        
        // Select answer for a question step
        function selectAnswer(step, value, button, stepNumber) {
            // Remove selected class from all buttons in this step
            const buttons = document.querySelectorAll(`#step${stepNumber} .option-btn`);
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            // Add selected class to clicked button
            button.classList.add('selected');
            
            // Store answer
            krishiAI.storeAnswer(step, value);
            
            // Enable next button
            document.getElementById(`nextStep${stepNumber}`).disabled = false;
        }
        
        // Navigate to next step
        function nextStep(currentStep) {
            if (currentStep === 1) {
                showStep(2);
            } else if (currentStep === 2) {
                showStep(3);
            }
        }
        
        // Navigate to previous step
        function previousStep(currentStep) {
            if (currentStep === 2) {
                showStep(1);
            } else if (currentStep === 3) {
                showStep(2);
            }
        }
        
        // Show specific step
        function showStep(stepNumber) {
            // Hide all steps
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            
            // Show target step
            document.getElementById(`step${stepNumber}`).classList.add('active');
        }
        
        // Generate final results
        function generateResults() {
            try {
                const enhancedQuery = krishiAI.buildEnhancedQuery();
                const actions = krishiAI.generateActions();
                const insights = krishiAI.generateInsights();
                const resources = krishiAI.generateResources();
                const trustedSites = krishiAI.getTrustedSites();
                
                // Update results UI
                displayResults(enhancedQuery, actions, insights, resources, trustedSites);
                
                // Show results section
                showSection('resultsSection');
            } catch (error) {
                console.error("Generate results failed:", error);
                alert('Sorry, there was an error generating results. Please try again.');
            }
        }
        
        // Display results in the UI
        function displayResults(enhancedQuery, actions, insights, resources, trustedSites) {
            // Display info cards
            displayInfoCards(insights, krishiAI.currentMatch);
            
            // Display action items
            displayActionItems(actions);
            
            // Update search links
            updateSearchLinks(enhancedQuery, resources, trustedSites);
        }
        
        // Display information cards
        function displayInfoCards(insights, match) {
            infoCards.innerHTML = '';
            
            // Add match info card
            const matchCard = document.createElement('div');
            matchCard.className = 'info-card';
            matchCard.innerHTML = `
                <div class="card-title">üéØ Semantic Match</div>
                <div class="card-content">
                    <strong>${match.term}</strong> (${match.type})<br>
                    Domain: ${match.data.domain}<br>
                    Confidence: ${(match.score * 100).toFixed(0)}%<br>
                    User Context: ${krishiAI.userAnswers.context || 'general'}
                </div>
            `;
            infoCards.appendChild(matchCard);
            
            // Add insight cards
            insights.forEach(insight => {
                const card = document.createElement('div');
                card.className = 'info-card';
                card.innerHTML = `
                    <div class="card-title">${insight.title}</div>
                    <div class="card-content">${insight.content}</div>
                `;
                infoCards.appendChild(card);
            });
        }
        
        // Display action items
        function displayActionItems(actions) {
            actionItems.innerHTML = '';
            
            actions.forEach(action => {
                const item = document.createElement('div');
                item.className = 'action-item';
                item.textContent = action;
                actionItems.appendChild(item);
            });
        }
        
        // Update all search tab links
        function updateSearchLinks(enhancedQuery, resources, trustedSites) {
            const e = encodeURIComponent;
            
            // Google tab
            document.getElementById('googleLink').href = `https://www.google.com/search?q=${e(enhancedQuery)}`;
            document.getElementById('googleLink').textContent = `Google: ${enhancedQuery}`;
            
            document.getElementById('googleScholarLink').href = `https://scholar.google.com/scholar?q=${e(resources.scholar)}`;
            document.getElementById('googleScholarLink').textContent = `Scholar: ${resources.scholar}`;
            
            document.getElementById('googleBooksLink').href = `https://www.google.com/search?tbm=bks&q=${e(enhancedQuery)}`;
            document.getElementById('googleBooksLink').textContent = `Books: ${enhancedQuery}`;
            
            // Scholar tab - add trusted sites
            document.getElementById('scholarLink').href = `https://scholar.google.com/scholar?q=${e(resources.scholar)}`;
            document.getElementById('scholarLink').textContent = `Google Scholar: ${resources.scholar}`;
            
            // Add trusted sites to scholar panel
            const scholarPanel = document.getElementById('scholar');
            trustedSites.forEach(site => {
                const domain = new URL(site).hostname;
                const link = document.createElement('a');
                link.href = site;
                link.target = '_blank';
                link.textContent = `üåê ${domain}`;
                scholarPanel.appendChild(link);
            });
            
            // YouTube tab
            document.getElementById('youtubeLink').href = `https://www.youtube.com/results?search_query=${e(resources.youtube)}`;
            document.getElementById('youtubeLink').textContent = `YouTube: ${resources.youtube}`;
            
            // Other tabs remain similar to previous implementation...
        }
        
        // Show specific section
        function showSection(sectionId) {
            // Hide all sections
            searchSection.style.display = 'none';
            questionSteps.style.display = 'none';
            resultsSection.style.display = 'none';
            
            // Show target section
            document.getElementById(sectionId).style.display = 'block';
        }
        
        // Show/hide loading overlay
        function showLoading(show) {
            loadingOverlay.style.display = show ? 'flex' : 'none';
            searchBtn.disabled = show;
        }
        
        // Show specific tab content
        function showTab(tabId) {
            // Hide all panels
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Show target panel
            document.getElementById(tabId).classList.add('active');
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // Reset search and start over
        function resetSearch() {
            queryInput.value = '';
            krishiAI.userAnswers = {};
            showSection('searchSection');
            queryInput.focus();
            
            // Reset step selections
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.disabled = true);
            document.getElementById('nextStep3').disabled = false;
            
            // Show first step
            showStep(1);
        }
        
        // Set example query
        function setExample(example) {
            queryInput.value = example;
            queryInput.focus();
        }
        
        // Update response time display
        function updateResponseTime(time) {
            const responseTimeElement = document.getElementById('responseTime');
            if (time) {
                responseTimeElement.textContent = `~${(time/1000).toFixed(1)}s`;
            } else {
                responseTimeElement.textContent = '~2.3s';
            }
        }
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
